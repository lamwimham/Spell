  /**\n   * 自动重置过期的配额\n   */\n  static async autoResetExpiredQuotas(): Promise<number> {\n    const __now = Date.now();\n    const expiredQuotas = await database\n      .get<UserQuota>('user_quotas')\n      .query(Q.where('reset_date', Q.lte(__now)), Q.where('quota_type', Q.notEq('total')))\n      .fetch();\n\n    let resetCount = 0;\n\n    await database.write(async () => {\n      for (const quota of expiredQuotas) {\n        await quota.update(record => {\n          record.quotaUsed = 0;\n\n          // 计算下次重置时间\n          if (record.quotaType === 'daily') {\n            const tomorrow = new Date();\n            tomorrow.setDate(tomorrow.getDate() + 1);\n            tomorrow.setHours(0, 0, 0, 0);\n            record.resetDate = tomorrow.getTime();\n          } else if (record.quotaType === 'monthly') {\n            const nextMonth = new Date();\n            nextMonth.setMonth(nextMonth.getMonth() + 1, 1);\n            nextMonth.setHours(0, 0, 0, 0);\n            record.resetDate = nextMonth.getTime();\n          }\n        });\n        resetCount++;\n      }\n    });\n\n    return resetCount;\n  }